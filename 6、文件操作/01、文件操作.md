# 文件操作

### 文件基本类型
文件通常是磁盘或固态硬盘上的一段已命名的存储区，内容都是以二进制形式存储。
>* 二进制文件——文件中的二进制值代表机器语言代码或数值数据【程序可以访问文件的每个字节】
>* 文本文件——文件最初使用二进制编码的字符表示文本。

<br>

### 文件操作模式
>* 二进制模式
>* 文本模式
>>* 程序以文本模式读取文件时，把本地环境表示的行末尾或文件结尾映射为C模式。
>>* 读取文件时：\r => \n，或 \r\n => \n
>>* 写入文件时：\n => \r，或\n =>\r\n

<br>

### 缓冲区
>* 把若干字符作为一个块进行传输比逐个发送这些字符节约时间；
>* 用户打错字符时，可以直接通过键盘修正错误；
>* 按下Enter键后，程序才可使用用户输入的字符。
>* 通常至少512字节
#### 缓冲分类
>* 完全缓冲输入——当缓冲区被填满时才刷新缓冲区（内容被发送至目的地），通常出现在文件输入中。缓冲区的大小取决于系统，常见的大小是512字节和4096字节。
>* 行缓冲——在出现换行符时刷新缓冲区。键盘输入通常是行缓冲输入，所以在按下Enter键后才刷新缓冲区。
#### 输入
>* 回显输入——用户输入的字符直接显示在屏幕中。
>* 无回显输入——击键后对应的字符不显示。

<br>

### 文件指针
>* 并不指向实际的文件，它指向一个包含文件信息的数据对象，其中包含操作文件的I/O函数所用的缓冲区信息。
>* 标准I/O函数根据文件指针包含的缓冲区信息，在必要时决定再次填充或清空缓冲区【 标准I/O函数不仅要知道缓冲区的位置，还要知道缓冲区被填充的程序以及操作哪一个文件】
>* FILE类型，定义在<stdio.h>头文件中。
<table>
    <tr>
        <th>序号</th>
        <th>标准文件</th>
        <th>文件指针</th>
        <th>通常使用的设备</th>
    </tr>
    <tr>
        <td>1</td>
        <td>标准输入</td>
        <td>stdin</td>
        <td>键盘</td>
    </tr>
        <tr>
        <td>2</td>
        <td>标准输出</td>
        <td>stdout</td>
        <td>显示器</td>
    </tr>
            <tr>
        <td>3</td>
        <td>标准错误输出</td>
        <td>stderr</td>
        <td>显示器</td>
    </tr>
   
</table>

<br>

### 文件打开【fopen()函数】【stdio.h文件】
>* 打开一个文件；
>* 创建一个缓冲区（在读写模式下会创建两个缓冲区）；
>* 文件成功打开后，返回一个指向该结构的文件指针【其他I/O函数可以使用该指针指定该文件】
>* 创建一个包含文件和缓冲区数据的结构【包含一个指定流中当前位置的文件位置指示器。还包含错误和文件结尾的指示器、一个指向缓冲区开始处的指针、一个文件标识符和一个计数（统计实际拷贝进缓冲区的字节数）】

<table>
    <tr>
        <th>序号</th>
        <th>模式</th>
        <th>文件指针位置</th>
        <th>功能</th>
        <th>打开文件不存在时</th>
        <th>打开文件存在时</th>
    </tr>
    <tr>
        <td>1</td>
        <td>r【rb】</td>
        <td rowspan=6>开头</td>
        <td>【读】</td>
        <td rowspan=2>——</td>
        <td rowspan=2>——</td>
    </tr>
        <tr>
        <td>2</td>
        <td>r+【rb+】</td>
        <td>【读】【写】</td>
    </tr>
    <tr>
        <td>3</td>
        <td>wx【xb】</td>
        <td>【写】</td>
        <td rowspan=6>创建新文件</td>
        <td rowspan=2>该文件已被独占，其他程序再打开就会报错。</td>
    </tr>
      <tr>
        <td>4</td>
        <td>wx+【xb+】</td>
        <td>【读】【写】</td>
    </tr>
      <tr>
        <td>5</td>
        <td>w【wb】</td>
        <td>【写】</td>
        <td rowspan=2>从开头开始编辑【原有内容会被清空】</td>
    </tr>  
        <tr>
        <td>6</td>
        <td>w+【wb+】</td>
        <td>【读】【写】</td>
    </tr>  
          <tr>
        <td>7</td>
        <td>a【ab】</td>
        <td rowspan=2>结尾</td>
        <td>【写】</td>
        <td rowspan=2>在结尾追加新的内容</td>
    </tr>  
            <tr>
        <td>8</td>
        <td>a+【ab+】</td>
        <td>【读】【写】</td>
    </tr>  
  
</table>

>* 模式中的字母与加号，可以任意排序。
>* UNIX和Linux系统都是文件类型系统，带b字母的模式和不带b字母的模式相同。

<br>

### 文件关闭【fclose()函数】
>* 关闭文件指针指向的文件，必要时刷新缓冲区。
>* 对于较正式的程序，应该检查是否成功关闭文件。
>* 如果成功关闭，返回0，否则返回EOF。
>* 如果磁盘已满、移动硬盘被移除或出现I/O错误，都会导致调用fclose()函数失败。

<br>

### 文件结尾符 EOF（（end of file）
>* 定义在stdio.h文件；
>* 已被#define宏替换为 -1；
```
#include<stdio.h>

int main(void){
    char c;

    c = getc(stdin);
    putc(c,stdout);

    return 0;
}
```
```
// 文件中输入/输出字符
#include<stdio.h>

int main(void){
    FILE *fp1,*fp2                      //  文件指针
    int i;                              // 用int类型的变量储存EOF

    fp1 = fopen("<input>.txt","r");     //  打开输入文件
    fp2 = fopen("<output>.txt","w");    //  打开输出文件

    while((i = fgetc(fp1))!=EOF){       // 为了避免读到空文件，不应该使用 do while循环   
        fputc(i,fp2);             
    }

    fclose(fp1);                        //  关闭文件，返回值为0时，正常关闭；否则关闭时出错
    fclose(fp2);

    return 0;
}
```









